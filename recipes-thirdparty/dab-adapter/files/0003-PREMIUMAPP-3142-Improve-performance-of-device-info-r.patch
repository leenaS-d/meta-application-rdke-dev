From 412c939ab30a80183d23f40d9b5afa25efa09501 Mon Sep 17 00:00:00 2001
From: Adam Stolcenburg <adam_stolcenburg@comcast.com>
Date: Tue, 14 Jan 2025 12:26:54 +0100
Subject: [PATCH 3/5] PREMIUMAPP-3142 Improve performance of device/info
 request

---
 src/device/rdk/interface.rs | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/src/device/rdk/interface.rs b/src/device/rdk/interface.rs
index f02c070..b501603 100644
--- a/src/device/rdk/interface.rs
+++ b/src/device/rdk/interface.rs
@@ -38,7 +38,7 @@ pub fn init(device_ip: &str, debug: bool) {
     }
 }
 
-pub fn get_device_id() -> Result<String, DabError> {
+fn request_device_id() -> Result<String, DabError> {
     let json_string =
         "{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"org.rdk.System.getDeviceInfo\",\"params\":{\"params\":[\"estb_mac\"]}}".to_string();
     let response = http_post(json_string)?;
@@ -51,6 +51,10 @@ pub fn get_device_id() -> Result<String, DabError> {
     Ok(device_id.replace(":", "").to_string())
 }
 
+pub fn get_device_id() -> Result<String, DabError> {
+    get_rdk_device_info("deviceid")
+}
+
 pub fn http_download(url: String) -> Result<(), DabError> {
     let client = Client::new();
 
@@ -452,6 +456,7 @@ lazy_static! {
                 }
             },
         };
+        rdk_device_info.insert(String::from("deviceid"), request_device_id().unwrap());
         rdk_device_info
     };
 }
-- 
2.43.0

